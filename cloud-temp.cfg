users:
  - name: alpine-user
    primary_group: alpine-user
    groups: wheel
    lock_passwd: false
    ssh_authorized_keys: []
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    shell: /bin/bash

disable_root: true
ssh_pwauth: true
ssh_deletekeys: true

cloud_init_modules:
  - migrator
  - seed_random
  - bootcmd
  - write-files
  - set_hostname
  - update_hostname
  - update_etc_hosts
  - ca-certs
  - rsyslog
  - users-groups
  - ssh

cloud_config_modules:
  - disk_setup
  - mounts
  - locale
  - set-passwords
  - package-update-upgrade-install
  - timezone
  - runcmd

cloud_final_modules:
  - rightscale_userdata
  - scripts-vendor
  - scripts-per-once
  - scripts-per-boot
  - scripts-user
  - ssh-authkey-fingerprints
  - keys-to-console
  - final-message

datasource_list: [ OpenStack ]
datasource:
  OpenStack:
    metadata_urls: ["http://169.254.169.254"]
    timeout: 5
    retries: 3
    apply_network_config: false

resize_rootfs: true
locale: en_US.UTF-8
timezone: UTC

package_update: true
packages:
  - bash
  - curl
  - sudo
  - wget
  - e2fsprogs-extra
  - iptables
  - ip6tables
  - uuidgen
  - nfs-utils
  - containerd
  - kubelet
  - kubeadm
  - kubectl
  - cni-plugins

runcmd:
  - |
    sed -i '/^PermitRootLogin/d' /etc/ssh/sshd_config
    echo "PermitRootLogin prohibit-password" >> /etc/ssh/sshd_config
    systemctl restart sshd
  - echo "br_netfilter" > /etc/modules-load.d/k8s.conf
  - modprobe br_netfilter
  - echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf
  - echo "net.bridge.bridge-nf-call-iptables=1" >> /etc/sysctl.conf
  - sysctl --system
  - swapoff -a
  - sed -i '/swap/s/^/#/' /etc/fstab
  - rc-update add containerd default
  - rc-service containerd start
  - kubeadm config images pull

final_message: "System is up after $UPTIME seconds"

system_info:
  distro: alpine
  default_user:
    name: alpine-user
    lock_passwd: false
    shell: /bin/bash
